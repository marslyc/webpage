import{c as k,m as _,n as O,o as I,Q as K,S as Q,p as $,q,r as Z,W as G,s as N,d as J,l as tt}from"./three.module-BUZdne6h.js";import{e as M,a as et}from"./eventHub-DmsUuzo6.js";import{O as ot}from"./OrbitControls-UBkTBaol.js";import{G as it}from"./GLTFLoader-DwfIB8W0.js";import{D as st}from"./DRACOLoader-DJwBgP83.js";import{g as nt}from"./index-DjKJqAo0.js";import{_ as H,r as R,o as U,a as P,c as A,b as t,u as g,p as at,e as rt,f as x}from"./index-CvBKhgFj.js";const F=new k,C=new O,D=new k;class ht{constructor(e,h){this.object=e,this.domElement=h,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;let o=0,c=0;this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onPointerDown=function(n){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(n.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0},this.onPointerUp=function(n){if(this.activeLook)switch(n.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1},this.onPointerMove=function(n){this.domElement===document?(this.pointerX=n.pageX-this.viewHalfX,this.pointerY=n.pageY-this.viewHalfY):(this.pointerX=n.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=n.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(n){switch(n.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}},this.onKeyUp=function(n){switch(n.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}},this.lookAt=function(n,b,w){return n.isVector3?D.copy(n):D.set(n,b,w),this.object.lookAt(D),E(this),this},this.update=function(){const n=new k;return function(w){if(this.enabled===!1)return;if(this.heightSpeed){const T=_.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=w*(T*this.heightCoef)}else this.autoSpeedFactor=0;const s=w*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(s+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(s),this.moveLeft&&this.object.translateX(-s),this.moveRight&&this.object.translateX(s),this.moveUp&&this.object.translateY(s),this.moveDown&&this.object.translateY(-s);let d=w*this.lookSpeed;this.activeLook||(d=0);let v=1;this.constrainVertical&&(v=Math.PI/(this.verticalMax-this.verticalMin)),c-=this.pointerX*d,this.lookVertical&&(o-=this.pointerY*d*v),o=Math.max(-85,Math.min(85,o));let S=_.degToRad(90-o);const z=_.degToRad(c);this.constrainVertical&&(S=_.mapLinear(S,0,Math.PI,this.verticalMin,this.verticalMax));const B=this.object.position;n.setFromSphericalCoords(1,S,z).add(B),this.object.lookAt(n)}}(),this.dispose=function(){this.domElement.removeEventListener("contextmenu",j),this.domElement.removeEventListener("pointerdown",a),this.domElement.removeEventListener("pointermove",i),this.domElement.removeEventListener("pointerup",f),window.removeEventListener("keydown",m),window.removeEventListener("keyup",L)};const i=this.onPointerMove.bind(this),a=this.onPointerDown.bind(this),f=this.onPointerUp.bind(this),m=this.onKeyDown.bind(this),L=this.onKeyUp.bind(this);this.domElement.addEventListener("contextmenu",j),this.domElement.addEventListener("pointerdown",a),this.domElement.addEventListener("pointermove",i),this.domElement.addEventListener("pointerup",f),window.addEventListener("keydown",m),window.addEventListener("keyup",L);function E(n){const b=n.object.quaternion;F.set(0,0,-1).applyQuaternion(b),C.setFromVector3(F),o=90-_.radToDeg(C.phi),c=_.radToDeg(C.theta)}this.handleResize(),E(this)}}function j(r){r.preventDefault()}const ct={type:"change"};class lt extends I{constructor(e,h){super(),this.object=e,this.domElement=h,this.enabled=!0,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const o=this,c=1e-6,i=new K,a=new k;this.tmpQuaternion=new K,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new k(0,0,0),this.rotationVector=new k(0,0,0),this.keydown=function(s){if(!(s.altKey||this.enabled===!1)){switch(s.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(s){if(this.enabled!==!1){switch(s.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}},this.pointerdown=function(s){if(this.enabled!==!1)if(this.dragToLook)this.status++;else{switch(s.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(s){if(this.enabled!==!1&&(!this.dragToLook||this.status>0)){const d=this.getContainerDimensions(),v=d.size[0]/2,S=d.size[1]/2;this.moveState.yawLeft=-(s.pageX-d.offset[0]-v)/v,this.moveState.pitchDown=(s.pageY-d.offset[1]-S)/S,this.updateRotationVector()}},this.pointerup=function(s){if(this.enabled!==!1){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(s.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}},this.pointercancel=function(){this.enabled!==!1&&(this.dragToLook?(this.status=0,this.moveState.yawLeft=this.moveState.pitchDown=0):(this.moveState.forward=0,this.moveState.back=0,this.updateMovementVector()),this.updateRotationVector())},this.contextMenu=function(s){this.enabled!==!1&&s.preventDefault()},this.update=function(s){if(this.enabled===!1)return;const d=s*o.movementSpeed,v=s*o.rollSpeed;o.object.translateX(o.moveVector.x*d),o.object.translateY(o.moveVector.y*d),o.object.translateZ(o.moveVector.z*d),o.tmpQuaternion.set(o.rotationVector.x*v,o.rotationVector.y*v,o.rotationVector.z*v,1).normalize(),o.object.quaternion.multiply(o.tmpQuaternion),(a.distanceToSquared(o.object.position)>c||8*(1-i.dot(o.object.quaternion))>c)&&(o.dispatchEvent(ct),i.copy(o.object.quaternion),a.copy(o.object.position))},this.updateMovementVector=function(){const s=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-s+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",f),this.domElement.removeEventListener("pointerdown",L),this.domElement.removeEventListener("pointermove",m),this.domElement.removeEventListener("pointerup",E),this.domElement.removeEventListener("pointercancel",n),window.removeEventListener("keydown",b),window.removeEventListener("keyup",w)};const f=this.contextMenu.bind(this),m=this.pointermove.bind(this),L=this.pointerdown.bind(this),E=this.pointerup.bind(this),n=this.pointercancel.bind(this),b=this.keydown.bind(this),w=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",f),this.domElement.addEventListener("pointerdown",L),this.domElement.addEventListener("pointermove",m),this.domElement.addEventListener("pointerup",E),this.domElement.addEventListener("pointercancel",n),window.addEventListener("keydown",b),window.addEventListener("keyup",w),this.updateMovementVector(),this.updateRotationVector()}}let y=new Q,dt=new $(16777215,.5);y.add(dt);let W=new q(16777215,5);W.position.set(10,100,10);y.add(W);let V=new Z(75,window.innerWidth/window.innerHeight,.1,1e5);V.position.set(1e3,1e3,1e3);class mt{constructor(){this.activeCamera=V,this.collection={default:V},M.on("toggleCamera",e=>{this.setActive(e)})}add(e,h){this.collection[e]=h}setActive(e){this.activeCamera=this.collection[e]}}const u=new mt;let p=new G({antialias:!0,logarithmicDepthBuffer:!0,physicallyCorrectLights:!0});p.setSize(window.innerWidth,window.innerHeight);p.shadowMap.enabled=!0;p.toneMapping=N;p.toneMappingExposure=1.5;class pt{constructor(){this.setOrbitControls(),M.on("toggleControls",e=>{this[`set${e}Controls`]()})}setOrbitControls(){this.controls=new ot(u.activeCamera,p.domElement),this.controls.enableDamping=!0,this.controls.maxPolarAngle=Math.PI/2,this.controls.minPolarAngle=0}setFlyControls(){this.controls=new lt(u.activeCamera,p.domElement),this.controls.movementSpeed=1e3,this.controls.rollSpeed=Math.PI/60}setFirstPersonControls(){this.controls=new ht(u.activeCamera,p.domElement),this.controls.movementSpeed=100,this.controls.rollSpeed=Math.PI/60}}const ut=new pt;u.activeCamera.aspect=window.innerWidth/window.innerHeight;u.activeCamera.updateProjectionMatrix();window.addEventListener("resize",()=>{u.activeCamera.aspect=window.innerWidth/window.innerHeight,u.activeCamera.updateProjectionMatrix(),p.setSize(window.innerWidth,window.innerHeight),p.setPixelRatio(window.devicePixelRatio)});class vt{constructor(e){this.scene=e,this.loader=new it;const h=new st;h.setDecoderPath("/draco/gltf/"),this.loader.setDRACOLoader(h);let o=new URL("/assets/city4-DgdybL21.glb",import.meta.url).href;this.loader.load(o,c=>{e.add(c.scene),this.gltf=c,c.scene.traverse(i=>{if(i.name=="汽车园区轨迹"){let a=i;a.visible=!1;let f=[];for(let m=a.geometry.attributes.position.count-1;m>=0;m--)f.push(new k(a.geometry.attributes.position.getX(m),a.geometry.attributes.position.getY(m),a.geometry.attributes.position.getZ(m)));this.curve=new J(f),this.curveprogress=0,this.carAnimation()}i.name=="redcar"&&(this.redcar=i)}),c.cameras.forEach(i=>{u.add(i.name,i)})})}update(e){this.mixer&&this.mixer.update(e)}carAnimation(){nt.to(this,{curveprogress:.999,duration:30,repeat:-1,onUpdate:()=>{let e=this.curve.getPoint(this.curveprogress);if(this.redcar.position.set(e.x,e.y,e.z),this.curveprogress+.001<1){let h=this.curve.getPoint(this.curveprogress+.001);this.redcar.lookAt(h)}}})}}let X;function ft(){X=new vt(y)}function wt(r){X.update(r)}const bt=new tt;function Y(r){const e=bt.getDelta();ut.controls.update(e),wt(e),requestAnimationFrame(Y),p.render(y,u.activeCamera)}const gt={__name:"ParkScene",props:{eventList:{type:Array,default:()=>{}}},setup(r){let e=R(null);return y.add(u.activeCamera),y.add(et),ft(),U(()=>{e.value.appendChild(p.domElement),Y()}),(h,o)=>(P(),A("div",{class:"scene",ref_key:"sceneDiv",ref:e},null,512))}},kt=H(gt,[["__scopeId","data-v-e9373d42"]]),l=r=>(at("data-v-c2cad3c5"),r=r(),rt(),r),St={id:"bigScreen"},_t=l(()=>t("div",{class:"header"},"超宇智慧园区系统管理平台",-1)),yt={class:"main"},Lt={class:"left"},Et={class:"cityEvent"},Mt=l(()=>t("h3",null,[t("span",null,"相机控制")],-1)),Ct=["src"],Dt=l(()=>t("span",null,"默认的相机视角",-1)),Rt=["src"],Vt=l(()=>t("span",null,"设置相机追随汽车导览园区",-1)),Pt=["src"],At=l(()=>t("span",null,"查看汽车司机视角",-1)),Kt=l(()=>t("div",{class:"footerBorder"},null,-1)),xt={class:"right"},Ft={class:"cityEvent list"},jt=l(()=>t("h3",null,[t("span",null,"切换园区观览模式")],-1)),Ht=["src"],Ut=l(()=>t("span",null," 轨道观览 ",-1)),Wt=l(()=>t("p",null,"可以锁定目标建筑和园区进行轨道式360°查看",-1)),Xt=["src"],Yt=l(()=>t("span",null," 飞行观览 ",-1)),zt=l(()=>t("p",null,"可以使用飞行模式进行园区进行观览",-1)),Bt=["src"],Tt=l(()=>t("span",null," 第一人称 ",-1)),Ot=l(()=>t("p",null,"可以使用第一人称模式进行园区进行观览",-1)),It=l(()=>t("div",{class:"footerBorder"},null,-1)),Qt={__name:"BigScreenPark",setup(r){let e=new URL("/assets/bar-LCN0kkKR.svg",import.meta.url).href;const h=c=>{M.emit("toggleCamera",c)},o=c=>{M.emit("toggleControls",c)};return(c,i)=>(P(),A("div",St,[_t,t("div",yt,[t("div",Lt,[t("div",Et,[Mt,t("h1",{onClick:i[0]||(i[0]=a=>h("default"))},[t("img",{class:"icon",src:g(e),alt:""},null,8,Ct),Dt]),t("h1",{onClick:i[1]||(i[1]=a=>h("carcamera_Orientation"))},[t("img",{class:"icon",src:g(e),alt:""},null,8,Rt),Vt]),t("h1",{onClick:i[2]||(i[2]=a=>h("rightcamera_Orientation"))},[t("img",{class:"icon",src:g(e),alt:""},null,8,Pt),At]),Kt])]),t("div",xt,[t("div",Ft,[jt,t("ul",null,[t("li",{onClick:i[3]||(i[3]=a=>o("Orbit"))},[t("h1",null,[t("div",null,[t("img",{class:"icon",src:g(e),alt:""},null,8,Ht),Ut])]),Wt]),t("li",{onClick:i[4]||(i[4]=a=>o("Fly"))},[t("h1",null,[t("div",null,[t("img",{class:"icon",src:g(e),alt:""},null,8,Xt),Yt])]),zt]),t("li",{onClick:i[5]||(i[5]=a=>o("FirstPerson"))},[t("h1",null,[t("div",null,[t("img",{class:"icon",src:g(e),alt:""},null,8,Bt),Tt])]),Ot])]),It])])])]))}},$t=H(Qt,[["__scopeId","data-v-c2cad3c5"]]),ie={__name:"Park",setup(r){R([]);let e=R([]);return U(()=>{}),(h,o)=>(P(),A("div",null,[x(kt,{eventList:g(e)},null,8,["eventList"]),x($t)]))}};export{ie as default};
